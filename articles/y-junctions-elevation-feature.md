---
title: "Y字路マップに高低差検索を追加しました"
emoji: "🗺️"
type: "tech"
topics:
  - "openstreetmap"
  - "地図"
  - "Y字路"
published: false
---

# Y字路マップに高低差検索を追加しました

前回の記事公開後、Y字路に関する記事を読んでいたところ、デイリーポータルZの[「理想的な『立体Y字路』を探して」](https://dailyportalz.jp/kiji/160826197281)という記事に出会いました。

この記事では、高低差のあるY字路（立体Y字路）の魅力が語られています。

- 片方の道が上り、もう片方は下りになっているY字路
- 鋭角で分岐するほど美しい
- 細い道の方が味わいがある

「こういうY字路を探したい人がいるなら、地図上で効率的に見つけられたら便利では？」と思い、高低差フィルター機能を追加しました。

サービスはこちら: https://storage.googleapis.com/y-junctions-prod-frontend/index.html

![高低差フィルター]()

---

## 使い方

### 高低差フィルター

左側のフィルターパネルに、新しく「最小角度の標高差」フィルターが追加されました。

- スライダーで範囲を指定（0〜10m+）
- 急坂の分岐を探す：5m以上に設定
- 平坦なY字路に絞る：1m以下で設定

![フィルター操作]()

### 標高差の表示

マーカーをクリックすると、ポップアップに「最小角度の標高差」が表示されます。

![ポップアップ表示]()

---

## 「最小角度の標高差」とは？

このマップで表示される「最小角度の標高差」が何を意味するのか、具体例で説明します。

### 具体例

```
Y字路の地点：標高50m

3本の道路：
- 道路A（南へ分岐）：10m先で標高50m → 差0m（平坦）
- 道路B（北北西へ分岐）：10m先で標高55m → 差5m（上り）
- 道路C（北北東へ分岐）：10m先で標高45m → 差5m（下り）

最小角度を構成する道路がBとC（角度30°）の場合
道路B（10m先）と道路C（10m先）の標高差
→ 最小角度の標高差 = |55 - 45| = 10m
```

つまり、Y字の分岐する2本の道が、どれくらい異なる高さに向かっているかを表す指標です。

前回の記事で説明した「最小角度」（Y字路の最も鋭い角度）を構成する2本の道路について、それぞれ10m先の地点同士の標高差を測定しています。

---

## 標高差の計算方法

このサービスで重要なのが、Y字路の標高差を計算するロジックです。前回の角度計算と同じように、いくつかの工夫があります。

### 使用している標高データ

国土地理院が提供する数値標高モデル（DEM5A）を使用しています。これは日本全国の地形を、5m×5mの格子状に区切って標高を記録したデータです。

データソース: [国土地理院 基盤地図情報（数値標高モデル）](https://fgd.gsi.go.jp/download/menu.php)

#### グリッド内での標高の特定方法

5mメッシュのデータから、任意の緯度・経度の標高を取得する仕組みは以下の通りです。

```
1. メッシュ内での相対位置を計算（0.0〜1.0の範囲に正規化）
2. グリッド座標に変換
   - 経度 → X座標（西から東）
   - 緯度 → Y座標（北から南）
3. 最も近いグリッド点に丸める（最近傍補間）
4. そのグリッド点の標高値を取得
```

![グリッド内での標高特定のイメージ図]()

つまり、与えられた座標に対して、最も近い5mグリッド点の標高値を使用します。

### 計算の手順

#### 1. Y字路の標高を取得

まず、Y字路の交差点の緯度・経度から、その地点の標高を取得します。

```
例：Y字路（35.6812°N, 139.7671°E）
    → 国土地理院のデータから標高を取得: 50m
```

#### 2. 各道路の方向に10m進んだ地点の座標を計算

Y字路から接続している3本の道路それぞれについて、その方向（方位角）に10メートル進んだ地点の座標を計算します。

```
Y字路から3本の道路が伸びている方向：
- 道路A: 180°（南）
- 道路B: 345°（北北西）
- 道路C: 15°（北北東）

各方向に10m進んだ地点の座標を計算
```

なぜ10メートルなのか？

この距離は以下の理由で選ばれています。

1. 標高データの解像度との整合
   - GSI DEM5Aは5m×5mのメッシュデータ
   - 10m進めば、多くの場合で異なるグリッド点の標高を取得できる
   - 近すぎる（1m）と、同じグリッド点になり標高差を検出できない可能性が高い

2. Y字路の分岐の特徴を捉える
   - 遠すぎる（100m）と、Y字路から離れた地形の影響を受けてしまう
   - 10mは、交差点から分岐した道路の「向き」（上り・下り）を把握するのに適度な距離

3. 実用的な勾配の把握
   - 10mで2mの標高差 = 勾配20％（かなりの急坂）
   - 10mで0.5mの標高差 = 勾配5％（ゆるい坂）
   - 人が「坂道」として認識できる範囲の勾配を検出可能

#### 3. 「最小角度の標高差」を計算

10m先の3地点の標高を取得し、前回説明した「最小角度」を構成する2本の道路を特定します。その2地点の標高差が「最小角度の標高差」です。

前述の例では、道路Bと道路Cが最小角度を構成するため、|55 - 45| = 10mが最小角度の標高差となります。

---

## 収録データについて

現在の収録範囲は関東地方です。

標高データは国土地理院の数値標高モデル（DEM5A）を使用しているため、データが提供されている範囲に限定されます。

### 注意点

- 標高データが取得できない場所では表示されません
- 橋・トンネルは自動的に除外されています（立体交差による誤判定を避けるため）

---

## 現在の課題

### 収録範囲の限定

現在は関東地方のみ対応しています。今後、ニーズに応じて範囲を拡大していく予定です。

### 「立体Y字路」を十分には捉えきれていない

デイリーポータルZの記事で語られている立体Y字路は、「片方が上り、もう片方が下り」という形です。

しかし、現在のフィルターでは、この違いを区別できません。

```
例1：片方上り・片方下りのY字路
- 道路A: 2m下り
- 道路B: 2m上り
→ 最小角度の標高差: 2m

例2：片方のみ坂のY字路
- 道路A: 5m上り
- 道路B: 0m平坦
→ 最小角度の標高差: 5m
```

例2の方が数値は大きいですが、デイリーポータルZの記事で紹介されているような立体Y字路を探すには、例1のような「上りと下りの組み合わせ」を判定できる必要があります。

### その他の制約

- 実際の隣接交差点までの距離は様々ですが、一律10m地点で計算しています
- 標高データが欠損している地域では表示されません

---

## 今後の予定

- 収録範囲の拡大
  - Y字路データ自体は全国、海外（韓国・台湾）への拡大が可能
  - ただし、標高データは国土地理院のデータに依存しているため、海外対応には各国の標高データ入手が必要
- 「片方上り・片方下り」を判定できる機能の追加も検討
- その他、皆さんのご意見次第で改善

---

## ご意見をお聞かせください

特に以下の点についてご意見をいただけるとうれしいです。

- 高低差フィルターの使い勝手
- 追加してほしい収録範囲
- 欲しい機能
- その他のご意見

アンケートは3分ほどで完了します。メールアドレスは不要です。

フィードバックを送る: https://docs.google.com/forms/d/e/1FAIpQLSfqyhKiE2CjepUycZBzfiMMQWnjxevtgsrX6MGVAcmq3LvU1A/viewform

---

## リンク

- サービス: https://storage.googleapis.com/y-junctions-prod-frontend/index.html
- 前回の記事:（リンク）
- フィードバック: https://docs.google.com/forms/d/e/1FAIpQLSfqyhKiE2CjepUycZBzfiMMQWnjxevtgsrX6MGVAcmq3LvU1A/viewform
- 技術的な詳細（GitHub）: https://github.com/cozy-corner/y-junctions
